<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collision Detection - Airport Tracking System</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .alert-critical {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .alert-warning {
            background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%);
            color: white;
        }

        .alert-safe {
            background: linear-gradient(135deg, #00cc66 0%, #009944 100%);
            color: white;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .collision-alert {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff4444;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .collision-alert.warning {
            border-left-color: #ffaa00;
        }

        .collision-alert.safe {
            border-left-color: #00cc66;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-severity {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .severity-critical {
            background: #ff4444;
            color: white;
        }

        .severity-warning {
            background: #ffaa00;
            color: white;
        }

        .severity-safe {
            background: #00cc66;
            color: white;
        }

        .flight-pair {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .flight-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }

        .flight-info h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .distance-indicator {
            text-align: center;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 6px;
            margin: 15px 0;
        }

        .distance-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .no-alerts {
            text-align: center;
            padding: 40px;
            color: #00cc66;
            font-size: 1.2em;
        }

        .monitoring-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>‚ö†Ô∏è Collision Detection System</h1>
            <p class="subtitle">Real-time Mid-Air Collision Risk Monitoring</p>
        </header>

        <main>
            <div class="dashboard-header">
                <a href="/" class="btn">‚Üê Back to Home</a>
                <button onclick="refreshData()" class="btn">üîÑ Refresh</button>
            </div>

            <div class="monitoring-status">
                <h3>üõ°Ô∏è Active Monitoring</h3>
                <p>Continuously scanning for potential collision risks</p>
                <p style="font-size: 0.9em; margin-top: 10px;">Last updated: <span id="last-update">-</span></p>
            </div>

            <div class="stats-grid" id="collision-stats">
                <div class="stat-card alert-safe">
                    <div class="stat-value" id="total-pairs">-</div>
                    <div class="stat-label">Flight Pairs Monitored</div>
                </div>
                <div class="stat-card alert-critical">
                    <div class="stat-value" id="critical-alerts">-</div>
                    <div class="stat-label">Critical Alerts</div>
                </div>
                <div class="stat-card alert-warning">
                    <div class="stat-value" id="warning-alerts">-</div>
                    <div class="stat-label">Warning Alerts</div>
                </div>
                <div class="stat-card alert-safe">
                    <div class="stat-value" id="safe-pairs">-</div>
                    <div class="stat-label">Safe Separations</div>
                </div>
            </div>

            <div class="info-section">
                <h2>Active Collision Alerts</h2>
                <div id="alerts-container">
                    <div class="no-alerts">
                        ‚úÖ No collision risks detected. All aircraft maintaining safe separation.
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h2>Safety Thresholds</h2>
                <div class="architecture-info">
                    <div class="arch-item">
                        <h4>üî¥ Critical</h4>
                        <p>Distance < 5 km</p>
                                <p style="font-size: 0.9em; color: #666;">Immediate action required</p>
                    </div>
                    <div class="arch-item">
                        <h4>üü° Warning</h4>
                        <p>Distance 5-10 km</p>
                        <p style="font-size: 0.9em; color: #666;">Monitor closely</p>
                    </div>
                    <div class="arch-item">
                        <h4>üü¢ Safe</h4>
                        <p>Distance > 10 km</p>
                        <p style="font-size: 0.9em; color: #666;">Normal separation</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function updateTimestamp() {
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }

        async function loadCollisionData() {
            try {
                const response = await fetch('/api/collision/check');
                const data = await response.json();

                if (data.success) {
                    const alerts = data.data;

                    // Update statistics
                    const critical = alerts.filter(a => a.severity === 'CRITICAL').length;
                    const warning = alerts.filter(a => a.severity === 'WARNING').length;
                    const safe = alerts.filter(a => a.severity === 'SAFE').length;

                    document.getElementById('total-pairs').textContent = alerts.length;
                    document.getElementById('critical-alerts').textContent = critical;
                    document.getElementById('warning-alerts').textContent = warning;
                    document.getElementById('safe-pairs').textContent = safe;

                    // Display alerts
                    const container = document.getElementById('alerts-container');

                    // Filter to show only critical and warning alerts
                    const activeAlerts = alerts.filter(a => a.severity !== 'SAFE');

                    if (activeAlerts.length === 0) {
                        container.innerHTML = '<div class="no-alerts">‚úÖ No collision risks detected. All aircraft maintaining safe separation.</div>';
                    } else {
                        container.innerHTML = activeAlerts.map(alert => `
                            <div class="collision-alert ${alert.severity.toLowerCase()}">
                                <div class="alert-header">
                                    <h3>‚ö†Ô∏è Collision Risk Detected</h3>
                                    <span class="alert-severity severity-${alert.severity.toLowerCase()}">
                                        ${alert.severity}
                                    </span>
                                </div>
                                
                                <div class="distance-indicator">
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Separation Distance</div>
                                    <div class="distance-value">${alert.distance.toFixed(2)} km</div>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                        ${alert.severity === 'CRITICAL' ? 'üö® IMMEDIATE ACTION REQUIRED' : '‚ö†Ô∏è Monitor Closely'}
                                    </div>
                                </div>

                                <div class="flight-pair">
                                    <div class="flight-info">
                                        <h4>‚úàÔ∏è Flight 1: ${alert.flight1.callsign}</h4>
                                        <div class="info-row">
                                            <span>Altitude:</span>
                                            <strong>${Math.round(alert.flight1.altitude)} ft</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Speed:</span>
                                            <strong>${Math.round(alert.flight1.velocity)} kts</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Latitude:</span>
                                            <strong>${alert.flight1.latitude.toFixed(4)}¬∞</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Longitude:</span>
                                            <strong>${alert.flight1.longitude.toFixed(4)}¬∞</strong>
                                        </div>
                                    </div>

                                    <div class="flight-info">
                                        <h4>‚úàÔ∏è Flight 2: ${alert.flight2.callsign}</h4>
                                        <div class="info-row">
                                            <span>Altitude:</span>
                                            <strong>${Math.round(alert.flight2.altitude)} ft</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Speed:</span>
                                            <strong>${Math.round(alert.flight2.velocity)} kts</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Latitude:</span>
                                            <strong>${alert.flight2.latitude.toFixed(4)}¬∞</strong>
                                        </div>
                                        <div class="info-row">
                                            <span>Longitude:</span>
                                            <strong>${alert.flight2.longitude.toFixed(4)}¬∞</strong>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px; font-size: 0.9em;">
                                    <strong>Recommendation:</strong> 
                                    ${alert.severity === 'CRITICAL'
                                ? 'Contact air traffic control immediately. Initiate evasive maneuvers if necessary.'
                                : 'Continue monitoring. Maintain current flight path unless instructed otherwise.'}
                                </div>
                            </div>
                        `).join('');
                    }

                    updateTimestamp();
                } else {
                    throw new Error(data.message || 'Failed to load collision data');
                }
            } catch (error) {
                console.error('Error loading collision data:', error);
                document.getElementById('alerts-container').innerHTML =
                    '<div class="no-alerts" style="color: #ff4444;">‚ùå Error loading collision data. Please check server connection.</div>';
            }
        }

        function refreshData() {
            loadCollisionData();
        }

        // Load on page load
        loadCollisionData();

        // Auto-refresh every 5 seconds (critical safety feature)
        setInterval(loadCollisionData, 5000);
    </script>
</body>

</html>