<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altitude Monitoring - Airport Tracking System</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .altitude-critical {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .altitude-warning {
            background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%);
            color: white;
        }

        .altitude-safe {
            background: linear-gradient(135deg, #00cc66 0%, #009944 100%);
            color: white;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .altitude-alert {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff4444;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .altitude-alert.warning {
            border-left-color: #ffaa00;
        }

        .altitude-alert.safe {
            border-left-color: #00cc66;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .alert-severity {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .severity-critical {
            background: #ff4444;
            color: white;
        }

        .severity-warning {
            background: #ffaa00;
            color: white;
        }

        .severity-safe {
            background: #00cc66;
            color: white;
        }

        .altitude-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }

        .detail-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .altitude-gauge {
            position: relative;
            height: 200px;
            background: linear-gradient(to top, #ff4444 0%, #ffaa00 30%, #00cc66 60%);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .gauge-marker {
            position: absolute;
            width: 100%;
            height: 3px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .gauge-label {
            position: absolute;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .no-alerts {
            text-align: center;
            padding: 40px;
            color: #00cc66;
            font-size: 1.2em;
        }

        .monitoring-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .flight-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }

        .recommendation-box {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 4px;
            border-left: 4px solid #ffaa00;
        }

        .recommendation-box.critical {
            background: #f8d7da;
            border-left-color: #ff4444;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üìâ Altitude Monitoring System</h1>
            <p class="subtitle">Real-time Low Altitude Detection & Safety Alerts</p>
        </header>

        <main>
            <div class="dashboard-header">
                <a href="/" class="btn">‚Üê Back to Home</a>
                <button onclick="refreshData()" class="btn">üîÑ Refresh</button>
            </div>

            <div class="monitoring-status">
                <h3>üõ°Ô∏è Active Altitude Monitoring</h3>
                <p>Continuously monitoring aircraft altitude for safety compliance</p>
                <p style="font-size: 0.9em; margin-top: 10px;">Last updated: <span id="last-update">-</span></p>
            </div>

            <div class="stats-grid" id="altitude-stats">
                <div class="stat-card altitude-safe">
                    <div class="stat-value" id="total-monitored">-</div>
                    <div class="stat-label">Aircraft Monitored</div>
                </div>
                <div class="stat-card altitude-critical">
                    <div class="stat-value" id="critical-alerts">-</div>
                    <div class="stat-label">Critical Altitude Alerts</div>
                </div>
                <div class="stat-card altitude-warning">
                    <div class="stat-value" id="warning-alerts">-</div>
                    <div class="stat-label">Warning Alerts</div>
                </div>
                <div class="stat-card altitude-safe">
                    <div class="stat-value" id="safe-aircraft">-</div>
                    <div class="stat-label">Safe Altitude</div>
                </div>
            </div>

            <div class="info-section">
                <h2>Active Altitude Alerts</h2>
                <div id="alerts-container">
                    <div class="no-alerts">
                        ‚úÖ All aircraft maintaining safe altitude. No violations detected.
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h2>Altitude Safety Thresholds</h2>
                <div class="architecture-info">
                    <div class="arch-item">
                        <h4>üî¥ Critical</h4>
                        <p>Below 1,000 ft</p>
                        <p style="font-size: 0.9em; color: #666;">Immediate danger - Emergency protocol</p>
                    </div>
                    <div class="arch-item">
                        <h4>üü° Warning</h4>
                        <p>1,000 - 3,000 ft</p>
                        <p style="font-size: 0.9em; color: #666;">Low altitude - Monitor closely</p>
                    </div>
                    <div class="arch-item">
                        <h4>üü¢ Safe</h4>
                        <p>Above 3,000 ft</p>
                        <p style="font-size: 0.9em; color: #666;">Normal operating altitude</p>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h2>Altitude Reference Guide</h2>
                <div class="altitude-gauge">
                    <div class="gauge-marker" style="bottom: 80%;">
                        <span class="gauge-label">Safe Zone: > 3,000 ft</span>
                    </div>
                    <div class="gauge-marker" style="bottom: 30%;">
                        <span class="gauge-label">Warning: 1,000 - 3,000 ft</span>
                    </div>
                    <div class="gauge-marker" style="bottom: 0%;">
                        <span class="gauge-label">Critical: < 1,000 ft</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function updateTimestamp() {
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }

        async function loadAltitudeData() {
            try {
                const response = await fetch('/api/altitude/check');
                const data = await response.json();

                if (data.success) {
                    const alerts = data.data;

                    // Update statistics
                    const critical = alerts.filter(a => a.severity === 'CRITICAL').length;
                    const warning = alerts.filter(a => a.severity === 'WARNING').length;
                    const safe = alerts.filter(a => a.severity === 'SAFE').length;

                    document.getElementById('total-monitored').textContent = alerts.length;
                    document.getElementById('critical-alerts').textContent = critical;
                    document.getElementById('warning-alerts').textContent = warning;
                    document.getElementById('safe-aircraft').textContent = safe;

                    // Display alerts
                    const container = document.getElementById('alerts-container');

                    // Filter to show only critical and warning alerts
                    const activeAlerts = alerts.filter(a => a.severity !== 'SAFE');

                    if (activeAlerts.length === 0) {
                        container.innerHTML = '<div class="no-alerts">‚úÖ All aircraft maintaining safe altitude. No violations detected.</div>';
                    } else {
                        container.innerHTML = activeAlerts.map(alert => {
                            const altitudeFt = Math.round(alert.altitude);
                            const isCritical = alert.severity === 'CRITICAL';

                            return `
                            <div class="altitude-alert ${alert.severity.toLowerCase()}">
                                <div class="alert-header">
                                    <h3>${isCritical ? 'üö®' : '‚ö†Ô∏è'} Low Altitude Alert</h3>
                                    <span class="alert-severity severity-${alert.severity.toLowerCase()}">
                                        ${alert.severity}
                                    </span>
                                </div>
                                
                                <div class="altitude-details">
                                    <div class="detail-card">
                                        <div class="detail-label">Flight Callsign</div>
                                        <div class="detail-value">‚úàÔ∏è ${alert.callsign}</div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-label">Current Altitude</div>
                                        <div class="detail-value" style="color: ${isCritical ? '#ff4444' : '#ffaa00'}">
                                            ${altitudeFt} ft
                                        </div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-label">Speed</div>
                                        <div class="detail-value">${Math.round(alert.velocity)} kts</div>
                                    </div>
                                    <div class="detail-card">
                                        <div class="detail-label">Threshold</div>
                                        <div class="detail-value">
                                            ${isCritical ? '< 1,000 ft' : '1,000-3,000 ft'}
                                        </div>
                                    </div>
                                </div>

                                <div class="flight-info-grid">
                                    <div class="info-item">
                                        <span>Latitude:</span>
                                        <strong>${alert.latitude.toFixed(4)}¬∞</strong>
                                    </div>
                                    <div class="info-item">
                                        <span>Longitude:</span>
                                        <strong>${alert.longitude.toFixed(4)}¬∞</strong>
                                    </div>
                                    <div class="info-item">
                                        <span>Vertical Rate:</span>
                                        <strong>${alert.verticalRate ? Math.round(alert.verticalRate) + ' ft/min' : 'N/A'}</strong>
                                    </div>
                                    <div class="info-item">
                                        <span>On Ground:</span>
                                        <strong>${alert.onGround ? 'Yes' : 'No'}</strong>
                                    </div>
                                </div>

                                <div class="recommendation-box ${isCritical ? 'critical' : ''}">
                                    <strong>‚ö†Ô∏è Safety Recommendation:</strong><br>
                                    ${isCritical
                                    ? `<strong style="color: #ff4444;">CRITICAL ALTITUDE VIOLATION!</strong><br>
                                           ‚Ä¢ Contact pilot immediately via emergency frequency<br>
                                           ‚Ä¢ Verify aircraft status and intentions<br>
                                           ‚Ä¢ Initiate emergency protocols if necessary<br>
                                           ‚Ä¢ Clear surrounding airspace<br>
                                           ‚Ä¢ Alert ground emergency services`
                                    : `<strong style="color: #ffaa00;">Low Altitude Warning</strong><br>
                                           ‚Ä¢ Monitor flight path continuously<br>
                                           ‚Ä¢ Verify pilot is aware of altitude<br>
                                           ‚Ä¢ Confirm approach/departure clearance<br>
                                           ‚Ä¢ Prepare for potential emergency response`}
                                </div>

                                <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 4px; font-size: 0.9em;">
                                    <strong>üìç Position:</strong> 
                                    Aircraft is ${alert.onGround ? 'on the ground' : 'in flight'} at 
                                    ${altitudeFt} feet ${alert.verticalRate > 0 ? '(climbing)' : alert.verticalRate < 0 ? '(descending)' : '(level)'}
                                </div>
                            </div>
                        `}).join('');
                    }

                    updateTimestamp();
                } else {
                    throw new Error(data.message || 'Failed to load altitude data');
                }
            } catch (error) {
                console.error('Error loading altitude data:', error);
                document.getElementById('alerts-container').innerHTML =
                    '<div class="no-alerts" style="color: #ff4444;">‚ùå Error loading altitude data. Please check server connection.</div>';
            }
        }

        function refreshData() {
            loadAltitudeData();
        }

        // Load on page load
        loadAltitudeData();

        // Auto-refresh every 5 seconds (critical safety feature)
        setInterval(loadAltitudeData, 5000);
    </script>
</body>

</html>